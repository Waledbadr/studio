# نظام جرد المخزون - EstateCare

## نظرة عامة

تم إضافة نظام شامل لجرد المخزون إلى تطبيق EstateCare يهدف إلى موازنة وتصحيح أرصدة المخزون بشكل دقيق ومنهجي.

## المميزات الرئيسية

### 1. إدارة عمليات الجرد
- **إنشاء جرد جديد**: إنشاء عمليات جرد مخصصة بنطاقات محددة
- **تتبع التقدم**: مراقبة تقدم عملية الجرد في الوقت الفعلي
- **إدارة الحالات**: حالات متعددة (تخطيط، قيد التنفيذ، مكتمل، ملغي)

### 2. نطاق الجرد المرن
- **اختيار المواقع**: تحديد مواقع محددة للجرد (مباني، طوابق، غرف)
- **تصفية الفئات**: جرد فئات محددة من الأصناف
- **اختيار الأصناف**: إمكانية جرد أصناف محددة أو جميع الأصناف

### 3. تنفيذ الجرد التفاعلي
- **عد الأصناف**: واجهة سهلة لإدخال الأعداد الفعلية
- **كشف الاختلافات**: تحديد تلقائي للاختلافات بين النظام والواقع
- **إضافة الملاحظات**: توثيق أسباب الاختلافات

### 4. مراجعة وتأكيد النتائج
- **مراجعة الاختلافات**: عرض مفصل لجميع الاختلافات المكتشفة
- **إجراءات التعديل**: موافقة، رفض، أو تعديل الاختلافات
- **توثيق الأسباب**: إضافة أسباب واضحة لكل تعديل

### 5. تطبيق التعديلات
- **تحديث المخزون**: تطبيق التعديلات المعتمدة على النظام
- **سجل المعاملات**: إنشاء سجلات معاملات لجميع التعديلات
- **تقارير شاملة**: تقارير مفصلة عن نتائج الجرد

## هيكل النظام

### الصفحات

1. **`/inventory/inventory-audit`** - الصفحة الرئيسية لإدارة عمليات الجرد
2. **`/inventory/inventory-audit/new`** - إنشاء جرد جديد
3. **`/inventory/inventory-audit/[id]/execute`** - تنفيذ عملية الجرد
4. **`/inventory/inventory-audit/[id]/review`** - مراجعة وتأكيد النتائج
5. **`/inventory/inventory-audit/[id]/complete`** - عرض النتائج النهائية
6. **`/inventory/inventory-audit/[id]`** - تفاصيل جرد محدد

### قاعدة البيانات

#### المجموعات الجديدة في Firestore:

1. **`inventoryAudits`** - معلومات عمليات الجرد
2. **`auditItems`** - تفاصيل الأصناف في كل جرد
3. **`auditAdjustments`** - التعديلات المطبقة

#### نوع المعاملة الجديد:
- **`AUDIT`** - تعديلات الجرد في `inventoryTransactions`

## سير العمل

### 1. التخطيط للجرد
```
إنشاء جرد جديد → تحديد النطاق → اختيار المواقع والأصناف → حفظ الإعدادات
```

### 2. تنفيذ الجرد
```
بدء الجرد → عد الأصناف → إدخال الأعداد الفعلية → توثيق الملاحظات
```

### 3. المراجعة والتأكيد
```
مراجعة الاختلافات → اتخاذ إجراءات التعديل → توثيق الأسباب → تأكيد النتائج
```

### 4. التطبيق والإنهاء
```
تطبيق التعديلات → تحديث المخزون → إنشاء التقارير → إرشفة الجرد
```

## الواجهات البرمجية

### InventoryContext - وظائف الجرد

```typescript
// إنشاء جرد جديد
createAudit(audit: Omit<InventoryAudit, 'id' | 'createdAt' | 'summary'>): Promise<string>

// جلب جميع عمليات الجرد
getAudits(): Promise<InventoryAudit[]>

// جلب جرد محدد
getAuditById(auditId: string): Promise<InventoryAudit | null>

// تحديث حالة الجرد
updateAuditStatus(auditId: string, status: InventoryAudit['status']): Promise<void>

// جلب أصناف الجرد
getAuditItems(auditId: string): Promise<AuditItem[]>

// تحديث صنف في الجرد
updateAuditItem(auditItem: AuditItem): Promise<void>

// إرسال عدد للجرد
submitAuditCount(auditId: string, itemId: string, physicalStock: number, notes: string, countedBy: string): Promise<void>

// إكمال الجرد وتطبيق التعديلات
completeAudit(auditId: string, adjustments: AuditAdjustment[], generalNotes: string): Promise<void>
```

## الأمان والصلاحيات

- **التحكم في الوصول**: فقط المستخدمون المخولون يمكنهم إنشاء عمليات الجرد
- **مراجعة مزدوجة**: إمكانية طلب مراجعة مزدوجة للاختلافات الكبيرة
- **سجل المراجعة**: تتبع جميع الإجراءات والتعديلات
- **النسخ الاحتياطية**: حفظ البيانات قبل تطبيق التعديلات

## التقارير

### تقارير الجرد تشمل:
- **ملخص الجرد**: إحصائيات عامة عن عملية الجرد
- **تفاصيل الاختلافات**: قائمة مفصلة بجميع الاختلافات
- **التعديلات المطبقة**: سجل بجميع التعديلات التي تم تطبيقها
- **تحليل الاتجاهات**: تحليل أنماط الاختلافات لتحسين العمليات

## التكامل مع النظام

### تحديث تقارير حركة المخزون
تم إضافة نوع معاملة "Audit Adjustment" إلى تقارير حركة المخزون لتتبع التعديلات الناتجة عن عمليات الجرد.

### القائمة الجانبية
تم إضافة رابط "جرد المخزون" إلى القائمة الجانبية للوصول السريع.

## الاستخدام

### بدء جرد جديد:
1. انتقل إلى صفحة الجرد من القائمة الجانبية
2. اضغط على "بدء جرد جديد"
3. أكمل معالج إعداد الجرد
4. ابدأ عملية العد

### متابعة جرد موجود:
1. اختر الجرد من القائمة
2. اضغط على "متابعة" إذا كان قيد التنفيذ
3. أكمل عد الأصناف المتبقية
4. راجع وأكد النتائج

## الدعم والصيانة

- **النسخ الاحتياطية**: يتم عمل نسخ احتياطية تلقائية لجميع بيانات الجرد
- **التحقق من سلامة البيانات**: فحص دوري لضمان تطابق البيانات
- **التحديثات**: تحديثات دورية لتحسين الأداء والوظائف

## المتطلبات التقنية

- **Firebase Firestore**: لتخزين بيانات الجرد
- **React/Next.js**: للواجهات التفاعلية
- **TypeScript**: للأمان في البرمجة
- **Tailwind CSS**: للتصميم المتجاوب

---

تم تطوير هذا النظام ليكون شاملاً وسهل الاستخدام، مع التركيز على الدقة والموثوقية في إدارة المخزون.
